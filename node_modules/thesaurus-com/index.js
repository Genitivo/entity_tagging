/*global $:true */

var request = require('sync-request');
var cheerio = require('cheerio');

function search(query) {
    var url = 'http://www.thesaurus.com/browse/' + encodeURIComponent(query);
    var req = request('GET', url);

    if (req.statusCode !== 200) {
        return {synonyms: [], antonyms: []};
    }


    $ = cheerio.load(req.getBody(), { ignoreWhitespace: true });
    var synonyms = $('div.relevancy-list ul li a.common-word');

    synonyms = synonyms.filter(function() {
      return $(this).attr('data-category') === '{"name": "relevant-3", "color": "#fcbb45"}';
    });

    synonyms = synonyms.map(function() {
      return $(this).text();
    }).get();


    for(var i=0;i<synonyms.length;i++){
      synonyms[i] = synonyms[i].substring(0,synonyms[i].indexOf('star'));
    }

    return {
        synonyms: synonyms
    };
}

exports.search = search;
